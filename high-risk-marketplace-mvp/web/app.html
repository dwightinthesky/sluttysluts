<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marketplace Control Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f7f7f5;
        --ink: #0f172a;
        --muted: #6b7280;
        --line: #e5e7eb;
        --surface: #ffffff;
        --brand: #be123c;
        --brand-soft: #ffe4e6;
        --accent: #1f2937;
        --danger: #b91c1c;
        --ok: #166534;
        --shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Manrope', sans-serif;
        color: var(--ink);
        background: var(--bg);
      }

      .shell {
        width: min(1240px, calc(100% - 30px));
        margin: 18px auto 24px;
      }

      .topbar {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 11px;
      }

      .brand-mark {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        display: grid;
        place-items: center;
        background: linear-gradient(140deg, #be123c, #e11d48);
        color: #fff;
        font: 800 0.92rem/1 'Sora', sans-serif;
      }

      .brand h1 {
        margin: 0;
        font: 700 1.08rem/1.2 'Sora', sans-serif;
      }

      .brand p {
        margin: 2px 0 0;
        color: var(--muted);
        font-size: 0.84rem;
      }

      .toolbar {
        display: flex;
        align-items: center;
        gap: 7px;
        flex-wrap: wrap;
      }

      .input,
      .select,
      .btn {
        border-radius: 10px;
        border: 1px solid var(--line);
        font: inherit;
      }

      .input,
      .select {
        background: #fff;
        padding: 10px 11px;
      }

      .btn {
        padding: 10px 12px;
        text-decoration: none;
        color: inherit;
        background: #fff;
        cursor: pointer;
        transition: all 0.22s ease;
      }

      .btn:hover {
        transform: translateY(-1px);
      }

      .btn.primary {
        background: var(--brand);
        border-color: var(--brand);
        color: #fff;
      }

      .btn.soft {
        background: #fff1f2;
        border-color: #fecdd3;
        color: #9f1239;
      }

      .persona {
        background: #fff1f2;
        border: 1px solid #fecdd3;
        color: #9f1239;
        border-radius: 999px;
        padding: 7px 12px;
        font-size: 0.84rem;
        font-weight: 700;
      }

      .layout {
        margin-top: 12px;
        display: grid;
        grid-template-columns: 248px minmax(0, 1fr);
        gap: 12px;
      }

      .side {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 18px;
        box-shadow: var(--shadow);
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-self: start;
        position: sticky;
        top: 12px;
      }

      .nav-btn {
        width: 100%;
        text-align: left;
        padding: 11px 12px;
        border-radius: 12px;
        border: 1px solid transparent;
        background: transparent;
        font: inherit;
        cursor: pointer;
      }

      .nav-btn strong {
        display: block;
        font: 700 0.95rem/1.2 'Sora', sans-serif;
      }

      .nav-btn small {
        color: var(--muted);
        font-size: 0.8rem;
      }

      .nav-btn.active {
        border-color: #fecdd3;
        background: #fff1f2;
      }

      .main {
        display: grid;
        gap: 10px;
      }

      .panel {
        display: none;
        gap: 10px;
      }

      .panel.active {
        display: grid;
      }

      .grid {
        display: grid;
        gap: 10px;
      }

      .grid.kpi {
        grid-template-columns: repeat(4, minmax(0, 1fr));
      }

      .grid.two {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--line);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: 15px;
      }

      .card h2,
      .card h3,
      .card h4 {
        margin: 0;
        font-family: 'Sora', sans-serif;
      }

      .card p {
        margin: 8px 0 0;
        color: var(--muted);
      }

      .kpi-value {
        margin-top: 8px;
        font: 800 1.8rem/1 'Sora', sans-serif;
      }

      .kpi-note {
        margin-top: 6px;
        color: var(--muted);
        font-size: 0.82rem;
      }

      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .label {
        font-size: 0.82rem;
        color: var(--muted);
      }

      .listing-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
      }

      .listing {
        border: 0;
        border-radius: 14px;
        padding: 0;
        background: #fff;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 8px;
        transition: transform 0.22s ease, box-shadow 0.22s ease;
        cursor: pointer;
      }

      .listing:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.1);
      }

      .listing:focus-visible {
        outline: 2px solid #be123c;
        outline-offset: 2px;
      }

      .listing-media {
        position: relative;
        width: 100%;
        aspect-ratio: 4 / 5;
        border-radius: 12px;
        overflow: hidden;
        background: #f3f4f6;
      }

      .listing-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.35s ease;
      }

      .listing:hover .listing-media img {
        transform: scale(1.05);
      }

      .listing-info {
        display: flex;
        flex-direction: column;
        gap: 4px;
        padding: 0 2px 2px;
        min-height: 88px;
      }

      .listing h4 {
        margin: 0;
        font: 500 0.86rem/1.25 'Sora', sans-serif;
        color: #6b7280;
      }

      .listing-sub {
        margin: 0;
        color: var(--muted);
        font-size: 0.78rem;
      }

      .listing-seller {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .seller-name {
        font: 600 0.76rem/1.2 'Sora', sans-serif;
        color: #111827;
      }

      .verified-icon {
        width: 14px;
        height: 14px;
        color: #3b82f6;
        flex: 0 0 auto;
      }

      .listing-title {
        margin: 0;
      }

      .listing-bottom {
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .listing-cta {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .listing-price {
        margin: 0;
        font: 700 0.95rem/1.2 'Sora', sans-serif;
        color: #111827;
      }

      .listing-view {
        display: inline-flex;
        align-items: center;
        padding: 4px 9px;
        border-radius: 999px;
        font: 600 0.7rem/1 'Sora', sans-serif;
        border: 1px solid #e5e7eb;
        color: #4b5563;
        background: #ffffff;
        text-decoration: none;
      }

      .listing-view:hover {
        border-color: #cbd5e1;
        color: #111827;
      }

      .listing-select {
        display: inline-flex;
        align-items: center;
        padding: 4px 9px;
        border-radius: 999px;
        font: 600 0.7rem/1 'Sora', sans-serif;
        border: 1px solid #e5e7eb;
        color: #4b5563;
        background: #ffffff;
      }

      .listing.is-selected .listing-select {
        border-color: #fecdd3;
        background: #fff1f2;
        color: #9f1239;
      }

      .listing.is-selected .listing-media {
        outline: 2px solid #fb7185;
        outline-offset: -2px;
      }

      .truncate-1 {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
      }

      .badge {
        display: inline-flex;
        border-radius: 999px;
        padding: 2px 8px;
        border: 1px solid #d1d5db;
        background: #fff;
        font-size: 0.68rem;
        font-weight: 700;
      }

      .badge.promo {
        border-color: #fecdd3;
        background: rgba(255, 255, 255, 0.92);
        color: #9f1239;
      }

      .badge-overlay {
        position: absolute;
        top: 10px;
        left: 10px;
      }

      .creator-layout {
        display: grid;
        gap: 10px;
      }

      .creator-left {
        display: grid;
        gap: 10px;
      }

      .creator-dark {
        background: #18181b;
        border-color: #27272a;
        color: #f4f4f5;
      }

      .creator-dark p {
        color: #a1a1aa;
      }

      .promo-metric-grid {
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px;
      }

      .promo-metric {
        border: 1px solid #27272a;
        border-radius: 12px;
        background: #111114;
        padding: 11px;
      }

      .promo-metric-accent {
        background: linear-gradient(145deg, #201215, #111114);
        border-color: #4c1d28;
      }

      .promo-label {
        margin: 0;
        font-size: 0.74rem;
        color: #a1a1aa;
      }

      .promo-value {
        margin-top: 7px;
        font: 700 1.4rem/1 'Sora', sans-serif;
        color: #fafafa;
      }

      .promo-value.rose {
        color: #fb7185;
      }

      .promo-note {
        margin-top: 6px;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        color: #34d399;
        font-size: 0.73rem;
        font-weight: 600;
      }

      .promo-note.muted {
        color: #a1a1aa;
        font-weight: 500;
      }

      .promo-active-list {
        margin-top: 10px;
        display: grid;
        gap: 8px;
      }

      .promo-active-item {
        border: 1px solid #27272a;
        border-radius: 12px;
        background: #111114;
        padding: 9px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }

      .promo-active-left {
        display: flex;
        align-items: center;
        gap: 9px;
        min-width: 0;
      }

      .promo-active-media {
        width: 40px;
        aspect-ratio: 4 / 5;
        border-radius: 8px;
        overflow: hidden;
        background: #27272a;
        flex: 0 0 auto;
      }

      .promo-active-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .promo-active-name {
        margin: 0;
        font: 600 0.82rem/1.2 'Sora', sans-serif;
        color: #f4f4f5;
      }

      .promo-active-meta {
        margin: 4px 0 0;
        font-size: 0.73rem;
        color: #a1a1aa;
      }

      .promo-chip {
        display: inline-flex;
        align-items: center;
        border-radius: 999px;
        border: 1px solid #4c1d28;
        background: rgba(244, 63, 94, 0.12);
        color: #fda4af;
        font-size: 0.64rem;
        font-weight: 700;
        padding: 2px 8px;
      }

      .promo-active-right {
        text-align: right;
        white-space: nowrap;
      }

      .promo-active-right strong {
        font: 700 0.84rem/1 'Sora', sans-serif;
      }

      .promo-active-right span {
        margin-top: 4px;
        display: block;
        font-size: 0.72rem;
        color: #a1a1aa;
      }

      .creator-buybox {
        background: #111114;
        border-color: #27272a;
        color: #f4f4f5;
        position: relative;
        overflow: hidden;
      }

      .creator-buybox::before {
        content: '';
        position: absolute;
        width: 190px;
        height: 190px;
        border-radius: 999px;
        background: rgba(244, 63, 94, 0.17);
        filter: blur(52px);
        top: -70px;
        right: -50px;
        pointer-events: none;
      }

      .creator-buybox p {
        color: #a1a1aa;
      }

      .promo-mode-toggle {
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 6px;
        border: 1px solid #27272a;
        border-radius: 10px;
        background: #09090b;
        padding: 4px;
      }

      .promo-mode-btn {
        border: 0;
        border-radius: 8px;
        padding: 8px 7px;
        font: 600 0.75rem/1 'Sora', sans-serif;
        background: transparent;
        color: #a1a1aa;
        cursor: pointer;
      }

      .promo-mode-btn.active {
        background: #27272a;
        color: #f4f4f5;
      }

      .promo-field {
        margin-top: 10px;
      }

      .promo-plan-list {
        margin-top: 10px;
        display: grid;
        gap: 8px;
      }

      .promo-plan {
        border: 1px solid #3f3f46;
        border-radius: 12px;
        background: rgba(39, 39, 42, 0.5);
        padding: 10px;
        cursor: pointer;
      }

      .promo-plan.active {
        border-color: #fb7185;
        background: rgba(244, 63, 94, 0.09);
      }

      .promo-plan-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .promo-plan-title {
        margin: 0;
        font: 600 0.85rem/1.2 'Sora', sans-serif;
      }

      .promo-plan-price {
        color: #fb7185;
        font: 700 0.82rem/1 'Sora', sans-serif;
      }

      .promo-plan-desc {
        margin: 6px 0 0;
        font-size: 0.73rem;
        color: #a1a1aa;
      }

      .promo-plan-badge {
        margin-left: 6px;
        font: 700 0.62rem/1 'Sora', sans-serif;
        color: #f4f4f5;
        background: #be123c;
        border-radius: 4px;
        padding: 3px 6px;
      }

      .promo-wallet-row {
        margin-top: 12px;
        margin-bottom: 9px;
        border-top: 1px solid #27272a;
        padding-top: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        font-size: 0.82rem;
        color: #a1a1aa;
      }

      .promo-wallet-row strong {
        color: #f4f4f5;
        font: 700 0.88rem/1 'Sora', sans-serif;
      }

      .console.compact {
        margin-top: 10px;
        min-height: 80px;
        max-height: 130px;
        font-size: 0.71rem;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th,
      .table td {
        text-align: left;
        border-bottom: 1px solid var(--line);
        padding: 9px 7px;
        font-size: 0.87rem;
      }

      .table th {
        color: var(--muted);
      }

      .console {
        margin: 0;
        border-radius: 12px;
        border: 1px solid #0f172a;
        background: #0f172a;
        color: #e2e8f0;
        font: 500 0.77rem/1.48 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
        padding: 11px;
        min-height: 160px;
        max-height: 280px;
        overflow: auto;
      }

      .good {
        color: var(--ok);
      }

      .bad {
        color: var(--danger);
      }

      .muted {
        color: var(--muted);
      }

      .timeline {
        margin-top: 7px;
        display: grid;
        gap: 8px;
      }

      .timeline div {
        border-left: 3px solid #cbd5e1;
        padding-left: 10px;
      }

      .timeline strong {
        display: block;
      }

      @media (max-width: 1120px) {
        .grid.kpi {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .promo-metric-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (min-width: 760px) {
        .listing-grid {
          grid-template-columns: repeat(3, minmax(0, 1fr));
        }
      }

      @media (min-width: 1180px) {
        .listing-grid {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }

      @media (max-width: 930px) {
        .layout {
          grid-template-columns: 1fr;
        }

        .side {
          position: static;
          flex-direction: row;
          overflow: auto;
        }

        .nav-btn {
          min-width: 195px;
        }

        .grid.two {
          grid-template-columns: 1fr;
        }
      }

      @media (min-width: 1020px) {
        .creator-layout {
          grid-template-columns: minmax(0, 1.2fr) minmax(320px, 0.8fr);
          align-items: start;
        }
      }

      @media (max-width: 720px) {
        .shell {
          width: calc(100% - 14px);
          margin-top: 8px;
        }

        .topbar {
          padding: 10px;
        }

        .grid.kpi {
          grid-template-columns: 1fr;
        }

        .toolbar {
          width: 100%;
        }

        .toolbar .input,
        .toolbar .select,
        .toolbar .btn,
        .toolbar .persona {
          flex: 1;
          min-width: 0;
        }
      }

      @media (max-width: 420px) {
        .listing-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="topbar">
        <div class="brand">
          <div class="brand-mark">SS</div>
          <div>
            <h1 data-i18n="brandTitle">Marketplace Control Center</h1>
            <p data-i18n="brandSub">Enterprise operations console for creator commerce</p>
          </div>
        </div>

        <div class="toolbar">
          <span id="persona" class="persona">Persona: Customer</span>
          <select id="langSelect" class="select" aria-label="Language selector">
            <option value="en">Eng</option>
            <option value="zh-TW">Zh-TW</option>
            <option value="hu">Hungarian</option>
            <option value="fr">French</option>
          </select>
          <input id="apiBase" class="input" value="http://localhost:8080" aria-label="API base" />
          <input id="webhookToken" class="input" value="dev-webhook-token" aria-label="Webhook token" />
          <button id="saveConfig" class="btn">Save</button>
          <a class="btn soft" href="./index.html" data-i18n="btnLanding">Landing</a>
        </div>
      </header>

      <div class="layout">
        <aside class="side">
          <button class="nav-btn active" data-panel="overview">
            <strong data-i18n="navOverview">Overview</strong>
            <small data-i18n="navOverviewSub">Revenue, risk, conversion pulse</small>
          </button>
          <button class="nav-btn" data-panel="customer">
            <strong data-i18n="navCustomer">Customer</strong>
            <small data-i18n="navCustomerSub">Explore and pending orders</small>
          </button>
          <button class="nav-btn" data-panel="creator">
            <strong data-i18n="navCreator">Creator</strong>
            <small data-i18n="navCreatorSub">Promotion and wallet operations</small>
          </button>
          <button class="nav-btn" data-panel="operations">
            <strong data-i18n="navOps">Operations</strong>
            <small data-i18n="navOpsSub">Webhook, payout, moderation</small>
          </button>
          <button class="nav-btn" data-panel="logs">
            <strong data-i18n="navLogs">API Logs</strong>
            <small data-i18n="navLogsSub">Request and response traces</small>
          </button>
        </aside>

        <main class="main">
          <section id="panel-overview" class="panel active">
            <div class="grid kpi">
              <article class="card">
                <h3 data-i18n="kpiListings">Active listings</h3>
                <div id="kpiListings" class="kpi-value">0</div>
                <div class="kpi-note" data-i18n="kpiListingsSub">Total visible catalog inventory</div>
              </article>
              <article class="card">
                <h3 data-i18n="kpiPromoted">Promoted share</h3>
                <div id="kpiPromoted" class="kpi-value">0%</div>
                <div class="kpi-note" data-i18n="kpiPromotedSub">Inventory with active promotion plans</div>
              </article>
              <article class="card">
                <h3 data-i18n="kpiAov">Projected AOV</h3>
                <div id="kpiAov" class="kpi-value">$0.00</div>
                <div class="kpi-note" data-i18n="kpiAovSub">Estimated total charged including buyer fee</div>
              </article>
              <article class="card">
                <h3 data-i18n="kpiRole">Current entry role</h3>
                <div id="kpiRole" class="kpi-value">customer</div>
                <div class="kpi-note" data-i18n="kpiRoleSub">Role hint carried from Landing URL</div>
              </article>
            </div>

            <div class="grid two">
              <article class="card">
                <h3 data-i18n="flowTitle">Business flow health</h3>
                <p data-i18n="flowSub">Critical checkpoints for checkout, payout, and reserve management.</p>
                <div class="timeline">
                  <div>
                    <strong data-i18n="flowPoint1">Pending order created</strong>
                    <span class="muted" data-i18n="flowPoint1Sub">Customer initiates hosted checkout with fee breakdown.</span>
                  </div>
                  <div>
                    <strong data-i18n="flowPoint2">Webhook processed</strong>
                    <span class="muted" data-i18n="flowPoint2Sub">Payment status transitions to held, failed, or chargeback.</span>
                  </div>
                  <div>
                    <strong data-i18n="flowPoint3">Payout release</strong>
                    <span class="muted" data-i18n="flowPoint3Sub">Creator wallet splits available and reserve balances.</span>
                  </div>
                </div>
              </article>
              <article class="card">
                <h3 data-i18n="quickTitle">Quick persona switch</h3>
                <p data-i18n="quickSub">Jump between role-centric workflows without returning to Landing.</p>
                <div class="row" style="margin-top: 10px">
                  <button class="btn soft" data-switch-role="customer" data-i18n="btnCustomerRole">Switch to Customer</button>
                  <button class="btn soft" data-switch-role="creator" data-i18n="btnCreatorRole">Switch to Creator</button>
                  <button class="btn soft" data-switch-role="admin" data-i18n="btnAdminRole">Switch to Admin</button>
                </div>
              </article>
            </div>
          </section>

          <section id="panel-customer" class="panel">
            <article class="card">
              <h3 data-i18n="customerTitle">Customer listing desk</h3>
              <p data-i18n="customerSub">Search inventory, select listing, and generate pending order request.</p>
              <div class="row" style="margin-top: 10px">
                <input id="searchInput" class="input" style="flex: 1" placeholder="Search listings" />
                <select id="filterSelect" class="select">
                  <option value="all">All</option>
                  <option value="promoted">Promoted</option>
                  <option value="organic">Organic</option>
                </select>
                <button id="refreshListings" class="btn" data-i18n="btnRefresh">Refresh</button>
              </div>
              <div id="listingGrid" class="listing-grid" style="margin-top: 10px"></div>
            </article>

            <article class="card">
              <h3 data-i18n="orderTitle">Order workspace</h3>
              <p data-i18n="orderSub">Creates pending order and returns hosted checkout URL.</p>
              <div class="row" style="margin-top: 10px">
                <input id="selectedListing" class="input" style="flex: 1" placeholder="Listing ID" />
                <button id="createOrderBtn" class="btn primary" data-i18n="btnCreateOrder">Create pending order</button>
              </div>
              <pre id="customerConsole" class="console" style="margin-top: 10px"></pre>
            </article>
          </section>

          <section id="panel-creator" class="panel">
            <div class="creator-layout">
              <div class="creator-left">
                <article class="card creator-dark">
                  <h3 data-i18n="promoGrowthTitle">Promotion & Growth</h3>
                  <p data-i18n="promoGrowthSub">Track exposure and boost your listings to reach more verified customers.</p>
                  <div class="promo-metric-grid">
                    <div class="promo-metric">
                      <p class="promo-label" data-i18n="promoMetricViewsLabel">Profile Views</p>
                      <div id="promoMetricViews" class="promo-value">0</div>
                      <span id="promoMetricViewsDelta" class="promo-note">+0.0%</span>
                    </div>
                    <div class="promo-metric">
                      <p class="promo-label" data-i18n="promoMetricBoostsLabel">Active Boosts</p>
                      <div id="promoMetricBoosts" class="promo-value">0</div>
                      <span id="promoMetricBoostsNote" class="promo-note muted">Listings promoted</span>
                    </div>
                    <div class="promo-metric promo-metric-accent">
                      <p class="promo-label" data-i18n="promoMetricLiftLabel">Est. Revenue Lift</p>
                      <div id="promoMetricLift" class="promo-value rose">+$0</div>
                      <span id="promoMetricLiftNote" class="promo-note muted" data-i18n="promoMetricLiftNote">
                        From promoted clicks
                      </span>
                    </div>
                  </div>
                </article>

                <article class="card creator-dark">
                  <div class="row" style="justify-content: space-between">
                    <div>
                      <h3 data-i18n="activePromoTitle">Active Promotions</h3>
                      <p data-i18n="activePromoSub">Monitor active campaigns and click output.</p>
                    </div>
                    <button id="loadPromotions" class="btn" data-i18n="btnLoadPromo">Load campaigns</button>
                  </div>
                  <div id="activePromotionsList" class="promo-active-list"></div>
                  <pre id="promoConsole" class="console compact"></pre>
                </article>
              </div>

              <aside class="card creator-buybox">
                <h3 data-i18n="promoBuyTitle">Buy Ranking Plans</h3>
                <p data-i18n="promoBuySub">Select a model to push your profile to the top of Explore.</p>

                <div class="promo-mode-toggle">
                  <button id="promoModeDuration" class="promo-mode-btn active" type="button" data-i18n="planDuration">
                    Duration-Based
                  </button>
                  <button id="promoModeClick" class="promo-mode-btn" type="button" data-i18n="planClick">
                    Click-Based (CPC)
                  </button>
                </div>

                <div class="promo-field">
                  <label class="label" for="creatorListing" data-i18n="promoListingLabel">Select Listing</label>
                  <select id="creatorListing" class="select" style="width: 100%"></select>
                </div>

                <div id="promoPlanOptions" class="promo-plan-list"></div>
                <select id="planSelect" class="select" style="display: none"></select>

                <div class="promo-wallet-row">
                  <span data-i18n="promoWalletLabel">Pay from wallet balance</span>
                  <strong id="walletAvailable">USD 450.00</strong>
                </div>

                <button id="buyPromoBtn" class="btn primary" style="width: 100%" data-i18n="btnBuyPromo">
                  Purchase promotion
                </button>

                <div class="row" style="margin-top: 9px">
                  <button id="walletRefresh" class="btn" data-i18n="btnWalletRefresh">Refresh wallet</button>
                  <input id="withdrawAmount" class="input" value="20" style="width: 92px" />
                  <button id="withdrawBtn" class="btn primary" data-i18n="btnWithdraw">Withdraw</button>
                </div>

                <pre id="walletConsole" class="console compact"></pre>
              </aside>
            </div>

            <article class="card">
              <h3 data-i18n="creatorTableTitle">Creator snapshot</h3>
              <table class="table" id="creatorTable">
                <thead>
                  <tr>
                    <th data-i18n="tblListing">Listing</th>
                    <th data-i18n="tblPrice">Price</th>
                    <th data-i18n="tblPromo">Promoted</th>
                    <th data-i18n="tblScore">Ranking score</th>
                  </tr>
                </thead>
                <tbody id="creatorTableBody"></tbody>
              </table>
            </article>
          </section>

          <section id="panel-operations" class="panel">
            <div class="grid two">
              <article class="card">
                <h3 data-i18n="webhookTitle">Webhook simulator</h3>
                <p data-i18n="webhookSub">Post payment event callbacks to update order and payment state.</p>
                <div class="row" style="margin-top: 10px">
                  <input id="webhookOrder" class="input" style="flex: 1" placeholder="Order ID" />
                  <select id="webhookStatus" class="select">
                    <option value="paid">paid</option>
                    <option value="failed">failed</option>
                    <option value="chargeback">chargeback</option>
                  </select>
                  <button id="sendWebhook" class="btn primary" data-i18n="btnSendWebhook">Send webhook</button>
                </div>
                <pre id="opsConsole" class="console" style="margin-top: 10px"></pre>
              </article>

              <article class="card">
                <h3 data-i18n="opsTitle">Settlement operations</h3>
                <p data-i18n="opsSub">Run payout release after delivery/dispute checks.</p>
                <div class="row" style="margin-top: 10px">
                  <button id="releasePayout" class="btn primary" data-i18n="btnReleasePayout">Run payout release</button>
                </div>
                <pre id="settlementConsole" class="console" style="margin-top: 10px"></pre>
              </article>
            </div>

            <article class="card">
              <h3 data-i18n="moderationTitle">Moderation command board</h3>
              <table class="table">
                <thead>
                  <tr>
                    <th data-i18n="tblEntity">Entity</th>
                    <th data-i18n="tblType">Type</th>
                    <th data-i18n="tblRisk">Risk</th>
                    <th data-i18n="tblAction">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>lst_9a2f</td>
                    <td>listing</td>
                    <td class="bad">65</td>
                    <td>review</td>
                  </tr>
                  <tr>
                    <td>msg_3bc1</td>
                    <td>chat_message</td>
                    <td class="bad">99.9</td>
                    <td>block</td>
                  </tr>
                  <tr>
                    <td>profile_111</td>
                    <td>profile</td>
                    <td class="good">5</td>
                    <td>allow</td>
                  </tr>
                </tbody>
              </table>
            </article>
          </section>

          <section id="panel-logs" class="panel">
            <article class="card">
              <h3 data-i18n="logsTitle">API request log stream</h3>
              <p data-i18n="logsSub">All actions are mirrored here for troubleshooting and demos.</p>
              <pre id="globalLog" class="console" style="margin-top: 10px"></pre>
            </article>
          </section>
        </main>
      </div>
    </div>

    <script>
      const I18N = {
        en: {
          personaLabel: 'Persona',
          brandTitle: 'Marketplace Control Center',
          brandSub: 'Enterprise operations console for creator commerce',
          btnLanding: 'Landing',
          navOverview: 'Overview',
          navOverviewSub: 'Revenue, risk, conversion pulse',
          navCustomer: 'Customer',
          navCustomerSub: 'Explore and pending orders',
          navCreator: 'Creator',
          navCreatorSub: 'Promotion and wallet operations',
          navOps: 'Operations',
          navOpsSub: 'Webhook, payout, moderation',
          navLogs: 'API Logs',
          navLogsSub: 'Request and response traces',
          kpiListings: 'Active listings',
          kpiListingsSub: 'Total visible catalog inventory',
          kpiPromoted: 'Promoted share',
          kpiPromotedSub: 'Inventory with active promotion plans',
          kpiAov: 'Projected AOV',
          kpiAovSub: 'Estimated total charged including buyer fee',
          kpiRole: 'Current entry role',
          kpiRoleSub: 'Role hint carried from Landing URL',
          flowTitle: 'Business flow health',
          flowSub: 'Critical checkpoints for checkout, payout, and reserve management.',
          flowPoint1: 'Pending order created',
          flowPoint1Sub: 'Customer initiates hosted checkout with fee breakdown.',
          flowPoint2: 'Webhook processed',
          flowPoint2Sub: 'Payment status transitions to held, failed, or chargeback.',
          flowPoint3: 'Payout release',
          flowPoint3Sub: 'Creator wallet splits available and reserve balances.',
          quickTitle: 'Quick persona switch',
          quickSub: 'Jump between role-centric workflows without returning to Landing.',
          btnCustomerRole: 'Switch to Customer',
          btnCreatorRole: 'Switch to Creator',
          btnAdminRole: 'Switch to Admin',
          customerTitle: 'Customer listing desk',
          customerSub: 'Search inventory, select listing, and generate pending order request.',
          btnRefresh: 'Refresh',
          orderTitle: 'Order workspace',
          orderSub: 'Creates pending order and returns hosted checkout URL.',
          btnCreateOrder: 'Create pending order',
          promoTitle: 'Promotion center',
          promoSub: 'Purchase ranking plans for creator listings.',
          promoGrowthTitle: 'Promotion & Growth',
          promoGrowthSub: 'Track exposure and boost your listings to reach more verified customers.',
          promoMetricViewsLabel: 'Profile Views',
          promoMetricBoostsLabel: 'Active Boosts',
          promoMetricBoostsNote: 'Listings promoted',
          promoMetricLiftLabel: 'Est. Revenue Lift',
          promoMetricLiftNote: 'From promoted clicks',
          activePromoTitle: 'Active Promotions',
          activePromoSub: 'Monitor active campaigns and click output.',
          activePromoEmpty: 'No active boosts yet. Buy a plan to start ranking.',
          activePromoChip: 'Top Ranking',
          activePromoDays: 'days remaining',
          activePromoClicks: 'Clicks',
          activePromoGenerated: 'Generated',
          promoBuyTitle: 'Buy Ranking Plans',
          promoBuySub: 'Select a model to push your profile to the top of Explore.',
          planDuration: 'Duration-Based',
          planClick: 'Click-Based (CPC)',
          promoListingLabel: 'Select Listing',
          promoWalletLabel: 'Pay from wallet balance',
          btnBuyPromo: 'Purchase promotion',
          btnLoadPromo: 'Sync campaigns',
          walletTitle: 'Wallet and withdrawals',
          walletSub: 'Track available and pending balances, then request withdrawal.',
          btnWalletRefresh: 'Refresh wallet',
          btnWithdraw: 'Withdraw',
          creatorTableTitle: 'Creator snapshot',
          webhookTitle: 'Webhook simulator',
          webhookSub: 'Post payment event callbacks to update order and payment state.',
          btnSendWebhook: 'Send webhook',
          opsTitle: 'Settlement operations',
          opsSub: 'Run payout release after delivery/dispute checks.',
          btnReleasePayout: 'Run payout release',
          moderationTitle: 'Moderation command board',
          logsTitle: 'API request log stream',
          logsSub: 'All actions are mirrored here for troubleshooting and demos.',
          tblListing: 'Listing',
          tblPrice: 'Price',
          tblPromo: 'Promoted',
          tblScore: 'Ranking score',
          tblEntity: 'Entity',
          tblType: 'Type',
          tblRisk: 'Risk',
          tblAction: 'Action'
        },
        'zh-TW': {
          personaLabel: '身份',
          brandTitle: 'Marketplace 控制中心',
          brandSub: 'Creator Commerce 的企業級營運 Console',
          btnLanding: '回 Landing',
          navOverview: '總覽',
          navOverviewSub: '營收、風險、轉換脈動',
          navCustomer: 'Customer',
          navCustomerSub: '探索與待付款訂單',
          navCreator: 'Creator',
          navCreatorSub: '推廣與錢包操作',
          navOps: '營運',
          navOpsSub: 'Webhook、撥款、審核',
          navLogs: 'API 紀錄',
          navLogsSub: '請求與回應追蹤',
          kpiListings: '有效商品數',
          kpiListingsSub: '目前可見的目錄總量',
          kpiPromoted: '置頂占比',
          kpiPromotedSub: '有啟用推廣方案的商品比例',
          kpiAov: '預估客單',
          kpiAovSub: '含 buyer fee 的預估 charged 金額',
          kpiRole: '目前入口角色',
          kpiRoleSub: '來自 Landing 的 role 參數',
          flowTitle: '商業流程健康度',
          flowSub: '結帳、撥款、保留金三大關鍵檢查點。',
          flowPoint1: '建立待付款訂單',
          flowPoint1Sub: 'Customer 建立含費率拆解的 hosted checkout 訂單。',
          flowPoint2: 'Webhook 回寫成功',
          flowPoint2Sub: '支付狀態轉移為 held、failed 或 chargeback。',
          flowPoint3: '撥款釋放',
          flowPoint3Sub: 'Creator 錢包拆成 available 與 reserve。',
          quickTitle: '快速切換角色',
          quickSub: '不回 Landing 也可切換角色導向流程。',
          btnCustomerRole: '切換 Customer',
          btnCreatorRole: '切換 Creator',
          btnAdminRole: '切換 Admin',
          customerTitle: 'Customer 商品工作台',
          customerSub: '搜尋商品、挑選 listing、建立 pending 訂單。',
          btnRefresh: '刷新',
          orderTitle: '下單工作區',
          orderSub: '建立待付款訂單並回傳 hosted checkout URL。',
          btnCreateOrder: '建立 pending 訂單',
          promoTitle: '推廣中心',
          promoSub: '為 Creator 商品購買排序方案。',
          promoGrowthTitle: '推廣與成長',
          promoGrowthSub: '追蹤曝光數據並提升商品觸及，觸達更多高信任買家。',
          promoMetricViewsLabel: '個人頁瀏覽',
          promoMetricBoostsLabel: '啟用中的置頂',
          promoMetricBoostsNote: '置頂中的商品數',
          promoMetricLiftLabel: '預估營收提升',
          promoMetricLiftNote: '來自推廣點擊',
          activePromoTitle: '目前推廣活動',
          activePromoSub: '追蹤正在執行的活動與點擊產出。',
          activePromoEmpty: '目前沒有啟用中的推廣，先購買方案開始衝刺曝光。',
          activePromoChip: '頂部排序',
          activePromoDays: '天剩餘',
          activePromoClicks: '點擊',
          activePromoGenerated: '已帶來',
          promoBuyTitle: '購買排序方案',
          promoBuySub: '選擇方案，把你的商品推到 Explore 前排。',
          planDuration: '天數型方案',
          planClick: '點擊型方案 (CPC)',
          promoListingLabel: '選擇商品',
          promoWalletLabel: '從錢包餘額扣款',
          btnBuyPromo: '購買推廣方案',
          btnLoadPromo: '同步活動',
          walletTitle: '錢包與提現',
          walletSub: '查詢 available / pending 餘額並申請提現。',
          btnWalletRefresh: '刷新錢包',
          btnWithdraw: '提現',
          creatorTableTitle: 'Creator 營運快照',
          webhookTitle: 'Webhook 模擬器',
          webhookSub: '送出支付事件回呼，更新訂單與支付狀態。',
          btnSendWebhook: '送出 webhook',
          opsTitle: '清算操作',
          opsSub: '在交付與爭議檢查後執行撥款釋放。',
          btnReleasePayout: '執行 payout release',
          moderationTitle: '內容審核指揮板',
          logsTitle: 'API 操作紀錄流',
          logsSub: '所有操作會同步寫入，方便除錯與展示。',
          tblListing: '商品',
          tblPrice: '價格',
          tblPromo: '置頂',
          tblScore: '排序分數',
          tblEntity: '實體',
          tblType: '類型',
          tblRisk: '風險',
          tblAction: '動作'
        },
        hu: {
          personaLabel: 'Szerep',
          brandTitle: 'Marketplace Control Center',
          brandSub: 'Vallalati operations console creator commerce-hez',
          btnLanding: 'Landing',
          navOverview: 'Attekintes',
          navOverviewSub: 'Bevetel, kockazat, konverzio',
          navCustomer: 'Customer',
          navCustomerSub: 'Felfedezes es pending rendelesek',
          navCreator: 'Creator',
          navCreatorSub: 'Promotion es wallet muveletek',
          navOps: 'Operations',
          navOpsSub: 'Webhook, payout, moderacio',
          navLogs: 'API naplok',
          navLogsSub: 'Request/response tracek',
          kpiListings: 'Aktiv listingek',
          kpiListingsSub: 'Lathato katalogus mennyiseg',
          kpiPromoted: 'Promotalt arany',
          kpiPromotedSub: 'Aktiv promotion planes listingek aranya',
          kpiAov: 'Becsult AOV',
          kpiAovSub: 'Becsult charged osszeg buyer feevel',
          kpiRole: 'Aktiv belepesi szerep',
          kpiRoleSub: 'Landing URL-bol erkezo szerep',
          flowTitle: 'Uzleti flow allapot',
          flowSub: 'Checkout, payout es reserve kulcs pontok.',
          flowPoint1: 'Pending rendeles letrehozva',
          flowPoint1Sub: 'Customer hosted checkout rendelest indit dij bontassal.',
          flowPoint2: 'Webhook feldolgozva',
          flowPoint2Sub: 'Statusz atvalt held, failed vagy chargeback allapotba.',
          flowPoint3: 'Payout release',
          flowPoint3Sub: 'Creator wallet available es reserve egyenlegre bomlik.',
          quickTitle: 'Gyors szerepvaltas',
          quickSub: 'Landing nelkul is valthatsz workflow-t.',
          btnCustomerRole: 'Valtas Customer',
          btnCreatorRole: 'Valtas Creator',
          btnAdminRole: 'Valtas Admin',
          customerTitle: 'Customer listing desk',
          customerSub: 'Kereses, listing valasztas, pending rendeles generalas.',
          btnRefresh: 'Frissites',
          orderTitle: 'Rendeles workspace',
          orderSub: 'Pending rendeles es hosted checkout URL generalasa.',
          btnCreateOrder: 'Pending rendeles',
          promoTitle: 'Promotion center',
          promoSub: 'Ranking plan vasarlas creator listingekhez.',
          promoGrowthTitle: 'Promotion & Growth',
          promoGrowthSub: 'Track exposure and boost listings to reach more verified customers.',
          promoMetricViewsLabel: 'Profile Views',
          promoMetricBoostsLabel: 'Active Boosts',
          promoMetricBoostsNote: 'Listings promoted',
          promoMetricLiftLabel: 'Est. Revenue Lift',
          promoMetricLiftNote: 'From promoted clicks',
          activePromoTitle: 'Active Promotions',
          activePromoSub: 'Monitor active campaigns and click output.',
          activePromoEmpty: 'No active boosts yet. Buy a plan to start ranking.',
          activePromoChip: 'Top Ranking',
          activePromoDays: 'days remaining',
          activePromoClicks: 'Clicks',
          activePromoGenerated: 'Generated',
          promoBuyTitle: 'Buy Ranking Plans',
          promoBuySub: 'Select a model to push your profile to the top of Explore.',
          planDuration: 'Duration-Based',
          planClick: 'Click-Based (CPC)',
          promoListingLabel: 'Select Listing',
          promoWalletLabel: 'Pay from wallet balance',
          btnBuyPromo: 'Purchase promotion',
          btnLoadPromo: 'Sync campaigns',
          walletTitle: 'Wallet es kiutalas',
          walletSub: 'Available/pending egyenleg kovetese es kiutalas kerese.',
          btnWalletRefresh: 'Wallet frissites',
          btnWithdraw: 'Withdraw',
          creatorTableTitle: 'Creator snapshot',
          webhookTitle: 'Webhook szimulator',
          webhookSub: 'Payment callback kuldese order/payment status frissiteshez.',
          btnSendWebhook: 'Webhook kuldese',
          opsTitle: 'Settlement operations',
          opsSub: 'Payout release futtatasa delivery/dispute ellenorzes utan.',
          btnReleasePayout: 'Payout release futtatasa',
          moderationTitle: 'Moderation board',
          logsTitle: 'API naplo stream',
          logsSub: 'Minden muvelet itt is naplozva van demohoz es hibakereseshez.',
          tblListing: 'Listing',
          tblPrice: 'Ar',
          tblPromo: 'Promotalt',
          tblScore: 'Rang pont',
          tblEntity: 'Entity',
          tblType: 'Tipus',
          tblRisk: 'Risk',
          tblAction: 'Action'
        },
        fr: {
          personaLabel: 'Role',
          brandTitle: 'Marketplace Control Center',
          brandSub: 'Console operations niveau entreprise pour creator commerce',
          btnLanding: 'Landing',
          navOverview: 'Vue globale',
          navOverviewSub: 'Revenus, risque, conversion',
          navCustomer: 'Customer',
          navCustomerSub: 'Exploration et commandes pending',
          navCreator: 'Creator',
          navCreatorSub: 'Promotion et operations wallet',
          navOps: 'Operations',
          navOpsSub: 'Webhook, payout, moderation',
          navLogs: 'Logs API',
          navLogsSub: 'Traces request/response',
          kpiListings: 'Listings actifs',
          kpiListingsSub: 'Volume catalogue visible',
          kpiPromoted: 'Part promue',
          kpiPromotedSub: 'Inventaire avec plans promotion actifs',
          kpiAov: 'AOV projete',
          kpiAovSub: 'Montant charged estime avec buyer fee',
          kpiRole: 'Role dentree courant',
          kpiRoleSub: 'Role recu depuis Landing',
          flowTitle: 'Sante du flux business',
          flowSub: 'Points critiques checkout, payout et reserve.',
          flowPoint1: 'Commande pending creee',
          flowPoint1Sub: 'Le Customer initie hosted checkout avec decomposition des frais.',
          flowPoint2: 'Webhook traite',
          flowPoint2Sub: 'Le statut passe a held, failed ou chargeback.',
          flowPoint3: 'Payout release',
          flowPoint3Sub: 'Le wallet creator separe available et reserve.',
          quickTitle: 'Changement de role rapide',
          quickSub: 'Basculez de workflow sans revenir au Landing.',
          btnCustomerRole: 'Basculer Customer',
          btnCreatorRole: 'Basculer Creator',
          btnAdminRole: 'Basculer Admin',
          customerTitle: 'Customer listing desk',
          customerSub: 'Recherche, selection listing et creation de commande pending.',
          btnRefresh: 'Rafraichir',
          orderTitle: 'Espace commande',
          orderSub: 'Cree une commande pending et renvoie lURL hosted checkout.',
          btnCreateOrder: 'Creer commande pending',
          promoTitle: 'Centre promotion',
          promoSub: 'Acheter des plans de ranking pour listings creator.',
          promoGrowthTitle: 'Promotion & Growth',
          promoGrowthSub: 'Track exposure and boost listings to reach more verified customers.',
          promoMetricViewsLabel: 'Profile Views',
          promoMetricBoostsLabel: 'Active Boosts',
          promoMetricBoostsNote: 'Listings promoted',
          promoMetricLiftLabel: 'Est. Revenue Lift',
          promoMetricLiftNote: 'From promoted clicks',
          activePromoTitle: 'Active Promotions',
          activePromoSub: 'Monitor active campaigns and click output.',
          activePromoEmpty: 'No active boosts yet. Buy a plan to start ranking.',
          activePromoChip: 'Top Ranking',
          activePromoDays: 'days remaining',
          activePromoClicks: 'Clicks',
          activePromoGenerated: 'Generated',
          promoBuyTitle: 'Buy Ranking Plans',
          promoBuySub: 'Select a model to push your profile to the top of Explore.',
          planDuration: 'Duration-Based',
          planClick: 'Click-Based (CPC)',
          promoListingLabel: 'Select Listing',
          promoWalletLabel: 'Pay from wallet balance',
          btnBuyPromo: 'Purchase promotion',
          btnLoadPromo: 'Sync campaigns',
          walletTitle: 'Wallet et retraits',
          walletSub: 'Suivre soldes available/pending et demander un retrait.',
          btnWalletRefresh: 'Rafraichir wallet',
          btnWithdraw: 'Withdraw',
          creatorTableTitle: 'Snapshot creator',
          webhookTitle: 'Simulateur webhook',
          webhookSub: 'Poster des callbacks paiement pour mettre a jour les statuts.',
          btnSendWebhook: 'Envoyer webhook',
          opsTitle: 'Operations de settlement',
          opsSub: 'Executer payout release apres verification delivery/dispute.',
          btnReleasePayout: 'Executer payout release',
          moderationTitle: 'Board moderation',
          logsTitle: 'Flux de logs API',
          logsSub: 'Toutes les actions sont journalisees pour demo et diagnostic.',
          tblListing: 'Listing',
          tblPrice: 'Prix',
          tblPromo: 'Promu',
          tblScore: 'Score ranking',
          tblEntity: 'Entite',
          tblType: 'Type',
          tblRisk: 'Risque',
          tblAction: 'Action'
        }
      };

      const state = {
        lang: 'en',
        role: 'customer',
        activePanel: 'overview',
        listings: [],
        logs: [],
        selectedListingId: '',
        promotionMode: 'duration',
        selectedPromoPlan: 'top-7d',
        walletSummary: {
          available: 450,
          pending: 0,
          currency: 'USD'
        },
        promotionSummary: null
      };

      const LISTING_PLACEHOLDER_IMAGE = `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(
        `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 1000'>
          <defs>
            <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
              <stop offset='0%' stop-color='#f3f4f6'/>
              <stop offset='100%' stop-color='#e5e7eb'/>
            </linearGradient>
          </defs>
          <rect width='800' height='1000' fill='url(#g)'/>
          <rect x='90' y='130' width='620' height='740' rx='28' fill='#ffffff' opacity='0.84'/>
          <text x='400' y='510' text-anchor='middle' fill='#6b7280' font-family='Arial, Helvetica, sans-serif' font-size='38'>
            Preview unavailable
          </text>
        </svg>`
      )}`;

      const fallbackListings = [
        {
          id: 'sample-lst-001',
          title: 'Premium Signature Bundle',
          sellerName: 'Lina Atelier',
          sellerVerified: true,
          subtitle: 'Worn 3 days • Sealed package',
          description: 'Hand-curated creator bundle with premium packaging and fast processing.',
          imageUrl: 'https://picsum.photos/id/1025/900/1125',
          price: 120,
          currency: 'USD',
          isPromoted: true,
          ranking: { score: 88 }
        },
        {
          id: 'sample-lst-002',
          title: 'Express Daily Drop',
          sellerName: 'Maya Studio',
          sellerVerified: true,
          subtitle: 'Express dispatch • Tracking included',
          description: 'Fast turnaround listing designed for repeat buyers and high satisfaction.',
          imageUrl: 'https://picsum.photos/id/1062/900/1125',
          price: 95,
          currency: 'USD',
          isPromoted: false,
          ranking: { score: 71 }
        },
        {
          id: 'sample-lst-003',
          title: 'Collectors Edition Drop',
          sellerName: 'Noir Archive',
          sellerVerified: true,
          subtitle: 'Limited quantity • Video proof',
          description: 'High-ticket curated listing with limited stock and collector positioning.',
          imageUrl: 'https://picsum.photos/id/1074/900/1125',
          price: 160,
          currency: 'USD',
          isPromoted: true,
          ranking: { score: 93 }
        }
      ];

      const PROMOTION_PLAN_CATALOG = {
        duration: [
          {
            id: 'top-24h',
            title: '24-Hour Spotlight',
            price: 15,
            description: 'Guaranteed top exposure shelf for 24 hours.'
          },
          {
            id: 'top-7d',
            title: '7-Day Dominance',
            price: 75,
            description: 'Continuous premium exposure with better weekly value.',
            badge: 'Best Value'
          }
        ],
        click: [
          {
            id: 'boost-200-clicks',
            title: '200 Guaranteed Clicks',
            price: 72,
            description: 'Pay only for verified profile clicks from high-intent buyers.'
          }
        ]
      };

      const el = {
        navButtons: document.querySelectorAll('.nav-btn'),
        panels: {
          overview: document.getElementById('panel-overview'),
          customer: document.getElementById('panel-customer'),
          creator: document.getElementById('panel-creator'),
          operations: document.getElementById('panel-operations'),
          logs: document.getElementById('panel-logs')
        },
        persona: document.getElementById('persona'),
        langSelect: document.getElementById('langSelect'),
        apiBase: document.getElementById('apiBase'),
        webhookToken: document.getElementById('webhookToken'),
        saveConfig: document.getElementById('saveConfig'),
        kpiListings: document.getElementById('kpiListings'),
        kpiPromoted: document.getElementById('kpiPromoted'),
        kpiAov: document.getElementById('kpiAov'),
        kpiRole: document.getElementById('kpiRole'),
        searchInput: document.getElementById('searchInput'),
        filterSelect: document.getElementById('filterSelect'),
        refreshListings: document.getElementById('refreshListings'),
        listingGrid: document.getElementById('listingGrid'),
        selectedListing: document.getElementById('selectedListing'),
        createOrderBtn: document.getElementById('createOrderBtn'),
        customerConsole: document.getElementById('customerConsole'),
        planSelect: document.getElementById('planSelect'),
        creatorListing: document.getElementById('creatorListing'),
        promoModeDuration: document.getElementById('promoModeDuration'),
        promoModeClick: document.getElementById('promoModeClick'),
        promoPlanOptions: document.getElementById('promoPlanOptions'),
        activePromotionsList: document.getElementById('activePromotionsList'),
        promoMetricViews: document.getElementById('promoMetricViews'),
        promoMetricViewsDelta: document.getElementById('promoMetricViewsDelta'),
        promoMetricBoosts: document.getElementById('promoMetricBoosts'),
        promoMetricBoostsNote: document.getElementById('promoMetricBoostsNote'),
        promoMetricLift: document.getElementById('promoMetricLift'),
        promoMetricLiftNote: document.getElementById('promoMetricLiftNote'),
        walletAvailable: document.getElementById('walletAvailable'),
        buyPromoBtn: document.getElementById('buyPromoBtn'),
        loadPromotions: document.getElementById('loadPromotions'),
        promoConsole: document.getElementById('promoConsole'),
        walletRefresh: document.getElementById('walletRefresh'),
        withdrawAmount: document.getElementById('withdrawAmount'),
        withdrawBtn: document.getElementById('withdrawBtn'),
        walletConsole: document.getElementById('walletConsole'),
        creatorTableBody: document.getElementById('creatorTableBody'),
        webhookOrder: document.getElementById('webhookOrder'),
        webhookStatus: document.getElementById('webhookStatus'),
        sendWebhook: document.getElementById('sendWebhook'),
        opsConsole: document.getElementById('opsConsole'),
        releasePayout: document.getElementById('releasePayout'),
        settlementConsole: document.getElementById('settlementConsole'),
        globalLog: document.getElementById('globalLog')
      };

      function safeLang(raw) {
        return Object.prototype.hasOwnProperty.call(I18N, raw) ? raw : 'en';
      }

      function getQuery() {
        const p = new URLSearchParams(window.location.search);
        return {
          role: p.get('role'),
          lang: p.get('lang')
        };
      }

      function persistConfig() {
        localStorage.setItem('saas_api_base', el.apiBase.value);
        localStorage.setItem('saas_webhook_token', el.webhookToken.value);
        localStorage.setItem('siteLang', state.lang);
      }

      function hydrateConfig() {
        const savedApi = localStorage.getItem('saas_api_base');
        const savedToken = localStorage.getItem('saas_webhook_token');
        if (savedApi) el.apiBase.value = savedApi;
        if (savedToken) el.webhookToken.value = savedToken;
      }

      function appendLog(title, payload) {
        const line = `[${new Date().toISOString()}] ${title}\n${
          typeof payload === 'string' ? payload : JSON.stringify(payload, null, 2)
        }\n`;
        state.logs.unshift(line);
        if (state.logs.length > 120) state.logs.pop();
        el.globalLog.textContent = state.logs.join('\n');
      }

      function writeConsole(target, title, payload) {
        const line = `[${new Date().toLocaleTimeString()}] ${title}\n${
          typeof payload === 'string' ? payload : JSON.stringify(payload, null, 2)
        }\n\n`;
        target.textContent = line + target.textContent;
        appendLog(title, payload);
      }

      function apiBase() {
        return (el.apiBase.value || '').replace(/\/$/, '');
      }

      async function request(path, options = {}) {
        const response = await fetch(`${apiBase()}${path}`, {
          method: options.method || 'GET',
          headers: {
            'Content-Type': 'application/json',
            ...(options.headers || {})
          },
          body: options.body ? JSON.stringify(options.body) : undefined
        });

        const raw = await response.text();
        const data = raw ? JSON.parse(raw) : {};

        if (!response.ok) {
          throw new Error(`${response.status} ${response.statusText} ${JSON.stringify(data)}`);
        }

        return data;
      }

      function escapeHtml(value) {
        return String(value || '').replace(/[&<>"']/g, (char) => {
          if (char === '&') return '&amp;';
          if (char === '<') return '&lt;';
          if (char === '>') return '&gt;';
          if (char === '"') return '&quot;';
          return '&#39;';
        });
      }

      function resolveListingImage(item) {
        const candidates = [
          item.imageUrl,
          item.image,
          item.coverImage,
          item.coverUrl,
          item.thumbnailUrl,
          item.mediaUrl,
          Array.isArray(item.images) ? item.images[0] : null,
          item.media && Array.isArray(item.media.images) ? item.media.images[0] : null
        ];

        for (const candidate of candidates) {
          if (typeof candidate !== 'string') continue;
          const trimmed = candidate.trim();
          if (!trimmed) continue;
          if (trimmed.startsWith('http://') || trimmed.startsWith('https://') || trimmed.startsWith('data:image')) {
            return trimmed;
          }
          if (trimmed.startsWith('/')) {
            return `${apiBase()}${trimmed}`;
          }
          return trimmed;
        }

        return LISTING_PLACEHOLDER_IMAGE;
      }

      function setPanel(panel) {
        state.activePanel = panel;
        Object.entries(el.panels).forEach(([key, panelEl]) => {
          panelEl.classList.toggle('active', key === panel);
        });
        el.navButtons.forEach((button) => button.classList.toggle('active', button.dataset.panel === panel));
      }

      function setRole(role) {
        const normalized = ['customer', 'creator', 'admin', 'ops'].includes(role) ? role : 'customer';
        state.role = normalized;
        const label = (I18N[state.lang] && I18N[state.lang].personaLabel) || 'Persona';
        el.persona.textContent = `${label}: ${normalized}`;
        el.kpiRole.textContent = normalized;

        if (normalized === 'creator') {
          setPanel('creator');
        } else if (normalized === 'admin' || normalized === 'ops') {
          setPanel('operations');
        } else {
          setPanel('customer');
        }
      }

      function renderI18n() {
        const dict = I18N[state.lang];
        document.documentElement.lang = state.lang;
        document.querySelectorAll('[data-i18n]').forEach((node) => {
          const key = node.getAttribute('data-i18n');
          if (dict[key]) node.textContent = dict[key];
        });
        const label = dict.personaLabel || 'Persona';
        el.persona.textContent = `${label}: ${state.role}`;
        el.langSelect.value = state.lang;
      }

      function renderKpis() {
        const total = state.listings.length;
        const promoted = state.listings.filter((item) => item.isPromoted).length;
        const promotedRate = total ? Math.round((promoted / total) * 100) : 0;
        const avg = total
          ? state.listings.reduce((sum, item) => sum + Number(item.price || 0), 0) / total
          : 0;

        el.kpiListings.textContent = String(total);
        el.kpiPromoted.textContent = `${promotedRate}%`;
        el.kpiAov.textContent = `$${(avg * 1.05).toFixed(2)}`;
      }

      function renderListings() {
        const search = (el.searchInput.value || '').trim().toLowerCase();
        const filter = el.filterSelect.value;
        const rows = state.listings.filter((item) => {
          const text = `${item.title || ''} ${item.description || ''} ${item.sellerName || ''} ${item.subtitle || ''}`.toLowerCase();
          const bySearch = !search || text.includes(search) || String(item.id).toLowerCase().includes(search);
          const byFilter =
            filter === 'all' ||
            (filter === 'promoted' && item.isPromoted) ||
            (filter === 'organic' && !item.isPromoted);
          return bySearch && byFilter;
        });

        if (!rows.length) {
          el.listingGrid.innerHTML =
            '<article class="card"><h4>No matching listings</h4><p>Try a different keyword or filter.</p></article>';
          return;
        }

        el.listingGrid.innerHTML = rows
          .map((item) => {
            const listingId = escapeHtml(item.id || 'unknown-listing');
            const rawListingId = String(item.id || 'unknown-listing');
            const title = escapeHtml(item.title || item.id || 'Untitled Listing');
            const sellerName = escapeHtml(item.sellerName || item.sellerId || 'Creator');
            const subtitle = escapeHtml(item.subtitle || 'Curated listing');
            const currency = escapeHtml(item.currency || 'USD');
            const price = Number(item.price || 0).toFixed(2);
            const imageUrl = escapeHtml(resolveListingImage(item));
            const alt = escapeHtml(`${item.title || 'Listing'} preview`);
            const isSelected = state.selectedListingId === rawListingId;
            const isVerified =
              item.sellerVerified === true ||
              item.verified === true ||
              item.kycStatus === 'approved' ||
              item.kycStatus === 'verified';

            return `
              <article class="listing ${isSelected ? 'is-selected' : ''}" data-select="${listingId}" role="button" tabindex="0">
                <div class="listing-media">
                  <img src="${imageUrl}" alt="${alt}" loading="lazy" data-listing-image="1" data-fallback="${escapeHtml(
                    LISTING_PLACEHOLDER_IMAGE
                  )}" />
                  ${item.isPromoted ? '<span class="badge promo badge-overlay">Promoted</span>' : ''}
                </div>
                <div class="listing-info">
                  <p class="listing-sub listing-seller">
                    <span class="seller-name truncate-1">${sellerName}</span>
                    ${
                      isVerified
                        ? `<svg class="verified-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                          </svg>`
                        : ''
                    }
                  </p>
                  <h4 class="listing-title truncate-1">${title}</h4>
                  <p class="listing-sub truncate-1">${subtitle}</p>
                  <div class="listing-bottom">
                    <p class="listing-price">${currency} ${price}</p>
                    <div class="listing-cta">
                      <a class="listing-view" data-view="1" href="./product-detail.html?listing=${encodeURIComponent(
                        item.id || ''
                      )}&lang=${encodeURIComponent(state.lang)}">View</a>
                      <span class="listing-select">${isSelected ? 'Selected' : 'Select'}</span>
                    </div>
                  </div>
                </div>
              </article>
            `;
          })
          .join('');

        document.querySelectorAll('.listing[data-select]').forEach((card) => {
          card.addEventListener('click', (event) => {
            if (event.target.closest('[data-view]')) return;
            const listingId = card.getAttribute('data-select') || '';
            state.selectedListingId = listingId;
            el.selectedListing.value = listingId;
            el.creatorListing.value = listingId;
            writeConsole(el.customerConsole, 'Listing Selected', { listingId });
            renderListings();
          });

          card.addEventListener('keydown', (event) => {
            if (event.target.closest('[data-view]')) return;
            if (event.key !== 'Enter' && event.key !== ' ') return;
            event.preventDefault();
            const listingId = card.getAttribute('data-select') || '';
            state.selectedListingId = listingId;
            el.selectedListing.value = listingId;
            el.creatorListing.value = listingId;
            writeConsole(el.customerConsole, 'Listing Selected', { listingId });
            renderListings();
          });
        });

        document.querySelectorAll('[data-listing-image]').forEach((img) => {
          img.addEventListener('error', () => {
            const fallback = img.getAttribute('data-fallback');
            if (fallback && img.getAttribute('src') !== fallback) {
              img.setAttribute('src', fallback);
            }
          });
        });
      }

      function t(key, fallback) {
        const dict = I18N[state.lang] || I18N.en;
        return dict[key] || fallback;
      }

      function money(amount, currency) {
        return `${currency || 'USD'} ${Number(amount || 0).toFixed(2)}`;
      }

      function firstNumeric(candidates, fallback = 0) {
        for (const value of candidates) {
          const n = Number(value);
          if (Number.isFinite(n)) return n;
        }
        return fallback;
      }

      function parseWalletSummary(payload) {
        return {
          available: firstNumeric(
            [
              payload && payload.available,
              payload && payload.availableBalance,
              payload && payload.wallet && payload.wallet.available,
              payload && payload.wallet && payload.wallet.availableBalance,
              payload && payload.summary && payload.summary.available,
              payload && payload.balances && payload.balances.available
            ],
            state.walletSummary.available
          ),
          pending: firstNumeric(
            [
              payload && payload.pending,
              payload && payload.pendingBalance,
              payload && payload.wallet && payload.wallet.pending,
              payload && payload.wallet && payload.wallet.pendingBalance,
              payload && payload.summary && payload.summary.pending,
              payload && payload.balances && payload.balances.pending
            ],
            state.walletSummary.pending
          ),
          currency:
            (payload && payload.currency) ||
            (payload && payload.wallet && payload.wallet.currency) ||
            (payload && payload.summary && payload.summary.currency) ||
            (payload && payload.balances && payload.balances.currency) ||
            state.walletSummary.currency ||
            'USD'
        };
      }

      function renderCreatorListingOptions() {
        const rows = state.listings.length ? state.listings : fallbackListings;
        const previous = (el.creatorListing.value || '').trim();
        const preferred = previous || state.selectedListingId || (rows[0] && rows[0].id) || '';

        el.creatorListing.innerHTML = rows
          .map((item) => `<option value="${escapeHtml(item.id)}">${escapeHtml(item.title || item.id)}</option>`)
          .join('');

        if (preferred) {
          el.creatorListing.value = preferred;
        }

        if (!el.creatorListing.value && rows[0]) {
          el.creatorListing.value = rows[0].id;
        }
      }

      function setPromotionMode(mode) {
        state.promotionMode = mode === 'click' ? 'click' : 'duration';
        el.promoModeDuration.classList.toggle('active', state.promotionMode === 'duration');
        el.promoModeClick.classList.toggle('active', state.promotionMode === 'click');

        const plans = PROMOTION_PLAN_CATALOG[state.promotionMode];
        const hasCurrent = plans.some((plan) => plan.id === state.selectedPromoPlan);
        if (!hasCurrent && plans[0]) state.selectedPromoPlan = plans[0].id;
      }

      function renderPromotionPlans() {
        setPromotionMode(state.promotionMode);
        const plans = PROMOTION_PLAN_CATALOG[state.promotionMode];

        el.planSelect.innerHTML = plans
          .map((plan) => `<option value="${escapeHtml(plan.id)}">${escapeHtml(plan.title)}</option>`)
          .join('');
        el.planSelect.value = state.selectedPromoPlan;

        el.promoPlanOptions.innerHTML = plans
          .map(
            (plan) => `
              <article class="promo-plan ${state.selectedPromoPlan === plan.id ? 'active' : ''}" data-plan-id="${escapeHtml(plan.id)}">
                <div class="promo-plan-top">
                  <p class="promo-plan-title">
                    ${escapeHtml(plan.title)}
                    ${plan.badge ? `<span class="promo-plan-badge">${escapeHtml(plan.badge)}</span>` : ''}
                  </p>
                  <span class="promo-plan-price">$${Number(plan.price).toFixed(2)}</span>
                </div>
                <p class="promo-plan-desc">${escapeHtml(plan.description)}</p>
              </article>
            `
          )
          .join('');

        el.promoPlanOptions.querySelectorAll('[data-plan-id]').forEach((node) => {
          node.addEventListener('click', () => {
            state.selectedPromoPlan = node.getAttribute('data-plan-id');
            renderPromotionPlans();
          });
        });
      }

      function renderPromotionMetrics() {
        const rows = state.listings.length ? state.listings : fallbackListings;
        const promotedCount = rows.filter((item) => item.isPromoted).length;
        const rankScore = rows.reduce((sum, item) => sum + Number((item.ranking && item.ranking.score) || 64), 0);
        const views = Math.round(760 + rankScore * 4.6 + promotedCount * 105);
        const trend = (6 + promotedCount * 2.2).toFixed(1);
        const estLift = Math.round(promotedCount * 160 + rankScore * 1.6);

        el.promoMetricViews.textContent = views.toLocaleString();
        el.promoMetricViewsDelta.textContent = `+${trend}%`;
        el.promoMetricBoosts.textContent = String(promotedCount);
        el.promoMetricBoostsNote.textContent = t('promoMetricBoostsNote', 'Listings promoted');
        el.promoMetricLift.textContent = `+$${estLift.toLocaleString()}`;
        el.promoMetricLiftNote.textContent = t('promoMetricLiftNote', 'From promoted clicks');
      }

      function renderActivePromotions() {
        const rows = (state.listings.length ? state.listings : fallbackListings).filter((item) => item.isPromoted);
        if (!rows.length) {
          el.activePromotionsList.innerHTML = `<article class="promo-active-item"><p class="promo-active-meta">${escapeHtml(
            t('activePromoEmpty', 'No active boosts yet. Buy a plan to start ranking.')
          )}</p></article>`;
          return;
        }

        el.activePromotionsList.innerHTML = rows
          .slice(0, 4)
          .map((item) => {
            const clicks = Math.max(14, Math.round(Number((item.ranking && item.ranking.score) || 68) * 0.58));
            const daysLeft = Math.max(1, Math.round(Number((item.ranking && item.ranking.score) || 68) % 7));
            return `
              <article class="promo-active-item">
                <div class="promo-active-left">
                  <div class="promo-active-media">
                    <img src="${escapeHtml(resolveListingImage(item))}" alt="${escapeHtml(item.title || item.id)}" loading="lazy" />
                  </div>
                  <div>
                    <p class="promo-active-name">${escapeHtml(item.title || item.id)}</p>
                    <p class="promo-active-meta">
                      <span class="promo-chip">${escapeHtml(t('activePromoChip', 'Top Ranking'))}</span>
                      ${daysLeft} ${escapeHtml(t('activePromoDays', 'days remaining'))}
                    </p>
                  </div>
                </div>
                <div class="promo-active-right">
                  <strong>${clicks} ${escapeHtml(t('activePromoClicks', 'Clicks'))}</strong>
                  <span>${escapeHtml(t('activePromoGenerated', 'Generated'))}</span>
                </div>
              </article>
            `;
          })
          .join('');
      }

      function renderWalletSummaryDisplay() {
        if (!el.walletAvailable) return;
        el.walletAvailable.textContent = money(state.walletSummary.available, state.walletSummary.currency);
      }

      function renderCreatorMonetization() {
        renderCreatorListingOptions();
        renderPromotionPlans();
        renderPromotionMetrics();
        renderActivePromotions();
        renderWalletSummaryDisplay();
      }

      function renderCreatorTable() {
        el.creatorTableBody.innerHTML = state.listings
          .map(
            (item) => `
            <tr>
              <td>${item.id}</td>
              <td>${item.currency || 'USD'} ${Number(item.price || 0).toFixed(2)}</td>
              <td>${item.isPromoted ? 'Yes' : 'No'}</td>
              <td>${item.ranking && item.ranking.score ? item.ranking.score : '-'}</td>
            </tr>
          `
          )
          .join('');
      }

      async function loadListings() {
        try {
          const data = await request('/v1/listings?status=all', {
            headers: { 'x-user-id': 'buyer-demo' }
          });
          if (Array.isArray(data.listings) && data.listings.length) {
            state.listings = data.listings;
          } else {
            state.listings = fallbackListings;
          }
          writeConsole(el.customerConsole, 'Listings Loaded', { count: state.listings.length });
        } catch (error) {
          state.listings = fallbackListings;
          writeConsole(el.customerConsole, 'Listings Fallback', String(error));
        }

        renderListings();
        renderCreatorMonetization();
        renderCreatorTable();
        renderKpis();
      }

      async function createOrder() {
        const listingId = (el.selectedListing.value || '').trim();
        if (!listingId) {
          writeConsole(el.customerConsole, 'Validation', 'Listing ID is required.');
          return;
        }

        try {
          const data = await request('/v1/orders', {
            method: 'POST',
            headers: { 'x-user-id': 'buyer-demo' },
            body: {
              buyerId: 'buyer-demo',
              listingId,
              currency: 'USD'
            }
          });

          if (data.order && data.order.id) {
            el.webhookOrder.value = data.order.id;
          }
          writeConsole(el.customerConsole, 'Order Created', data);
        } catch (error) {
          writeConsole(el.customerConsole, 'Order Error', String(error));
        }
      }

      async function buyPromotion() {
        const listingId = (el.creatorListing.value || '').trim();
        if (!listingId) {
          writeConsole(el.promoConsole, 'Validation', 'Listing ID is required.');
          return;
        }

        try {
          const data = await request('/v1/promotions/purchase', {
            method: 'POST',
            headers: { 'x-user-id': 'seller-demo' },
            body: {
              sellerId: 'seller-demo',
              listingId,
              planId: state.selectedPromoPlan || el.planSelect.value,
              currency: 'USD'
            }
          });
          writeConsole(el.promoConsole, 'Promotion Purchased', data);
          await loadListings();
          await refreshWallet();
        } catch (error) {
          writeConsole(el.promoConsole, 'Promotion Error', String(error));
        }
      }

      async function loadPromotions() {
        try {
          const data = await request('/v1/sellers/seller-demo/promotions', {
            headers: { 'x-user-id': 'seller-demo' }
          });
          state.promotionSummary = data;
          writeConsole(el.promoConsole, 'Promotion Summary', data);
          renderActivePromotions();
        } catch (error) {
          writeConsole(el.promoConsole, 'Promotion Load Error', String(error));
        }
      }

      async function refreshWallet() {
        try {
          const data = await request('/v1/wallets/seller-demo/summary?currency=USD', {
            headers: { 'x-user-id': 'seller-demo' }
          });
          state.walletSummary = parseWalletSummary(data);
          writeConsole(el.walletConsole, 'Wallet Summary', data);
          renderWalletSummaryDisplay();
        } catch (error) {
          writeConsole(el.walletConsole, 'Wallet Error', String(error));
        }
      }

      async function requestWithdrawal() {
        const amount = Number(el.withdrawAmount.value);
        if (!Number.isFinite(amount) || amount <= 0) {
          writeConsole(el.walletConsole, 'Validation', 'Withdraw amount must be positive.');
          return;
        }

        try {
          const data = await request('/v1/wallets/seller-demo/withdrawals', {
            method: 'POST',
            headers: { 'x-user-id': 'seller-demo' },
            body: {
              amount,
              currency: 'USD',
              payoutMethod: 'wire'
            }
          });
          writeConsole(el.walletConsole, 'Withdrawal Requested', data);
          await refreshWallet();
        } catch (error) {
          writeConsole(el.walletConsole, 'Withdrawal Error', String(error));
        }
      }

      async function sendWebhook() {
        const orderId = (el.webhookOrder.value || '').trim();
        if (!orderId) {
          writeConsole(el.opsConsole, 'Validation', 'Order ID is required.');
          return;
        }

        try {
          const data = await request('/v1/payments/webhooks/high-risk', {
            method: 'POST',
            headers: {
              'x-webhook-token': el.webhookToken.value
            },
            body: {
              eventId: `evt-${orderId}-${Date.now()}`,
              orderId,
              paymentStatus: el.webhookStatus.value,
              pspTxnId: `txn-${Date.now()}`
            }
          });
          writeConsole(el.opsConsole, 'Webhook Sent', data);
        } catch (error) {
          writeConsole(el.opsConsole, 'Webhook Error', String(error));
        }
      }

      async function runPayoutRelease() {
        try {
          const data = await request('/v1/payouts/release', {
            method: 'POST',
            headers: { 'x-user-id': 'admin-demo' },
            body: { force: true }
          });
          writeConsole(el.settlementConsole, 'Payout Release', data);
          await refreshWallet();
        } catch (error) {
          writeConsole(el.settlementConsole, 'Payout Error', String(error));
        }
      }

      function bindEvents() {
        el.navButtons.forEach((button) => {
          button.addEventListener('click', () => setPanel(button.dataset.panel));
        });

        document.querySelectorAll('[data-switch-role]').forEach((button) => {
          button.addEventListener('click', () => setRole(button.getAttribute('data-switch-role')));
        });

        el.saveConfig.addEventListener('click', () => {
          persistConfig();
          appendLog('Config Saved', { apiBase: el.apiBase.value, webhookToken: '***' });
        });

        el.searchInput.addEventListener('input', renderListings);
        el.filterSelect.addEventListener('change', renderListings);
        el.refreshListings.addEventListener('click', loadListings);
        el.createOrderBtn.addEventListener('click', createOrder);
        el.buyPromoBtn.addEventListener('click', buyPromotion);
        el.loadPromotions.addEventListener('click', loadPromotions);
        el.walletRefresh.addEventListener('click', refreshWallet);
        el.withdrawBtn.addEventListener('click', requestWithdrawal);
        el.promoModeDuration.addEventListener('click', () => {
          setPromotionMode('duration');
          renderPromotionPlans();
        });
        el.promoModeClick.addEventListener('click', () => {
          setPromotionMode('click');
          renderPromotionPlans();
        });
        el.creatorListing.addEventListener('change', () => {
          const current = (el.creatorListing.value || '').trim();
          if (current) {
            state.selectedListingId = current;
            el.selectedListing.value = current;
          }
        });
        el.sendWebhook.addEventListener('click', sendWebhook);
        el.releasePayout.addEventListener('click', runPayoutRelease);

        el.langSelect.addEventListener('change', (event) => {
          state.lang = safeLang(event.target.value);
          renderI18n();
          renderCreatorMonetization();
          persistConfig();
        });
      }

      function boot() {
        hydrateConfig();
        const query = getQuery();

        state.lang = safeLang(query.lang || localStorage.getItem('siteLang') || 'en');
        renderI18n();

        setRole(query.role || 'customer');
        bindEvents();

        loadListings();
        refreshWallet();

        appendLog('Boot', {
          role: state.role,
          lang: state.lang,
          apiBase: apiBase()
        });
      }

      boot();
    </script>
  </body>
</html>
